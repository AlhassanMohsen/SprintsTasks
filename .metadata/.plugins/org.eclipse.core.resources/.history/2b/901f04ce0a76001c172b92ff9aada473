/*
 * DELAY.c
 *
 *  Created on: Jan 15, 2022
 *      Author: vip
 */


#include "DELAY_interface.h"
#include "DELAY_prv.h"


static volatile uint8_t msDelayCounter=0 ;



DelayErrorState_t DELAY_ms(uint8_t u8MsDelay)
{
	uint8_t u8ErrorState = DELAY_OK;
	TIM0_Config_t DelayConfig = {TIM0_CTC,PRESCALAR_64};

	// initiate the timer in CTC Mode with system clock pre-scaled by 64
	u8ErrorState = TIM0_u8Init(&DelayConfig);

	if (u8ErrorState == TIM0_OK)
	{
		// set the compare value with DELAY_MS_COMPARE_COUNTS = 124 to ensure a
		u8ErrorState = TIM0_u8SetCompareValue(DELAY_MS_COMPARE_COUNTS);
	}else{
		u8ErrorState = DELAY_TMER_RETURN_ERROR;
	}
	if (u8ErrorState == TIM0_OK)
	{
		u8ErrorState = TIM0_u8EnableOCInterrupt(DELAY_vMsCallBackFun);
	}else{
		u8ErrorState = DELAY_TMER_RETURN_ERROR;
	}
	if (u8ErrorState == TIM0_OK)
	{
		u8ErrorState = TIM0_u8TimerStart();
	}else{
		u8ErrorState = DELAY_TMER_RETURN_ERROR;
	}


	while (msDelayCounter <= u8MsDelay);
	return u8ErrorState;
}


void DELAY_vMsCallBackFun(void)
{
	msDelayCounter++;
}
